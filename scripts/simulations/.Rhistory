library(data.table)
df <- fread("/Users/andrewmarderstein/Documents/Research/druggene/output/pgs_drug.txt",data.table = F,stringsAsFactors = F)
df$pgs <- -1*df$pgs
df$P_0.00001.R2_0.1.KB_250 <- -1*df$P_0.00001.R2_0.1.KB_250
df$PGS000007 <- -1*df$PGS000007
cor.test(df$P_0.00001.R2_0.1.KB_250,df$PGS000007)
head(df,1)
mod<-glm(disease ~ scale(df[,'pgs'])+bmi+age+menopause+number_live_birth+one_birth+
PC1+PC2+PC3+PC4+PC5+PC6+PC7+PC8+PC9+PC10, data = df,family = binomial(link='logit'))
combined_beta <- exp(summary(mod)$coef[2,1])
combined_low <- exp(summary(mod)$coef[2,1]-1.96*summary(mod)$coef[2,2])
combined_high <- exp(summary(mod)$coef[2,1]+1.96*summary(mod)$coef[2,2])
mod <- glm(disease ~ scale(df[,'P_0.00001.R2_0.1.KB_250'])+bmi+age+menopause+number_live_birth+one_birth+
PC1+PC2+PC3+PC4+PC5+PC6+PC7+PC8+PC9+PC10, data = df,family = binomial(link='logit'))
internal_beta <- exp(summary(mod)$coef[2,1])
internal_low <- exp(summary(mod)$coef[2,1]-1.96*summary(mod)$coef[2,2])
internal_high <- exp(summary(mod)$coef[2,1]+1.96*summary(mod)$coef[2,2])
mod<-glm(disease ~ scale(df[,'PGS000007'])+bmi+age+menopause+number_live_birth+one_birth+
PC1+PC2+PC3+PC4+PC5+PC6+PC7+PC8+PC9+PC10, data = df,family = binomial(link='logit'))
external_beta <- exp(summary(mod)$coef[2,1])
external_low <- exp(summary(mod)$coef[2,1]-1.96*summary(mod)$coef[2,2])
external_high <- exp(summary(mod)$coef[2,1]+1.96*summary(mod)$coef[2,2])
res <- data.frame(PGS=c('Combined','Internal','External'))
res$OR <- c(combined_beta,internal_beta,external_beta)
res$low <- c(combined_low,internal_low,external_low)
res$high <- c(combined_high,internal_high,external_high)
res
tmp <- list(); ind = 0
for (i in c(-1,1)) {
for (j in c(-1,1)) {
ind <- ind + 1
x1 <- binom.test(mean(sign(log(df.sub$beta_snp))==i & sign(log(df.sub$beta_int))==j)*nrow(df.sub),nrow(df.sub),0.25)
# x1 <- binom.test(mean(sign(df.sub$BETA)==i & sign(log(df.sub$beta_int))==j)*nrow(df.sub),nrow(df.sub),0.25)
tmp[[ind]] <- data.frame(marginal_sign=i,interaction_sign=j,name=paste0(ifelse(i==1,'+','-'),'/',ifelse(j==1,'+','-')),coord=as.numeric(i==j),low=x1$conf.int[1],est=as.numeric(x1$estimate),high=x1$conf.int[2],p=x1$p.value)
}
}
dim(df.sub)
library(data.table)
f <- "/Users/andrewmarderstein/Documents/Research/druggene/output/snp_int/SNP_by_drug.BC.txt"
df <- fread(f,data.table = F,stringsAsFactors = F)
gwas <- fread("/Users/andrewmarderstein/Documents/Research/druggene/output/snp_int/clean_PGS000007.txt.gz",data.table = F,stringsAsFactors = F)
df$SNP.adj <- substring(df$SNP,1,as.numeric(gregexpr('_',df$SNP))-1)
df <- merge(df,gwas[,c('RSID','BETA','BP')],by.x='SNP.adj',by.y='RSID')
df$FDR <- p.adjust(df$p_int,method = 'fdr')
df.sub <- subset(df,FDR<0.5)# & p_snp <0.05)
df.sub <- subset(df,p_int<0.05)# & p_snp <0.05)
df.sub <- df.sub[order(df.sub$CHR),]
tmp <- list(); ind = 0
for (i in c(-1,1)) {
for (j in c(-1,1)) {
ind <- ind + 1
x1 <- binom.test(mean(sign(log(df.sub$beta_snp))==i & sign(log(df.sub$beta_int))==j)*nrow(df.sub),nrow(df.sub),0.25)
# x1 <- binom.test(mean(sign(df.sub$BETA)==i & sign(log(df.sub$beta_int))==j)*nrow(df.sub),nrow(df.sub),0.25)
tmp[[ind]] <- data.frame(marginal_sign=i,interaction_sign=j,name=paste0(ifelse(i==1,'+','-'),'/',ifelse(j==1,'+','-')),coord=as.numeric(i==j),low=x1$conf.int[1],est=as.numeric(x1$estimate),high=x1$conf.int[2],p=x1$p.value)
}
}
tmp <- do.call(rbind,tmp)
tmp
tmp <- list(); ind = 0
for (i in c(-1,1)) {
for (j in c(-1,1)) {
ind <- ind + 1
# x1 <- binom.test(mean(sign(log(df.sub$beta_snp))==i & sign(log(df.sub$beta_int))==j)*nrow(df.sub),nrow(df.sub),0.25)
x1 <- binom.test(mean(sign(df.sub$BETA)==i & sign(log(df.sub$beta_int))==j)*nrow(df.sub),nrow(df.sub),0.25)
tmp[[ind]] <- data.frame(marginal_sign=i,interaction_sign=j,name=paste0(ifelse(i==1,'+','-'),'/',ifelse(j==1,'+','-')),coord=as.numeric(i==j),low=x1$conf.int[1],est=as.numeric(x1$estimate),high=x1$conf.int[2],p=x1$p.value)
}
}
tmp <- do.call(rbind,tmp)
tmp
